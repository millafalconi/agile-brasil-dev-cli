#!/usr/bin/env bash
# vim: ft=sh

SOLUTION_DESC="CLI solution script for 'dev'"
SUBCOMMAND_DESC="Shortcuts to handle local dev env"
SUBCOMMAND_HELP=$(cat <<EOH

init                  Init, configure the local dev environment;
                      and start the app.
                      
start                 Start transervicos in local dev environment.

stop [SERVER]         Stop transervicos in local dev environment. 

clean_data            Clean all data in local dev environment.

db_migrate            Run DB migration.

goto                  Open transervicos app in localhost. 
                      Will trigger 'open URL', in OSX this
                      will fire up your browser.

EOH
)

function start() {
  docker-compose start
}

function init() {
  docker-compose up --build -d
  db_migrate
}

function stop() {
  docker-compose stop ${1}
}

function clean_db_data() {
  stop db
  docker volume rm transervicos_db_data
}

function goto() {
  open http://localhost:3000
}

function db_migrate() {
  docker-compose run web bash -c "rake db:create && rake db:migrate"
}

is_help_mode "${@}" && return

case ${1} in
  start)
    start
    ;;
  init)
    init
    ;;
  stop)
    stop
    ;;
  clean_data)
    clean_db_data
    ;;
  db_migrate)
    db_migrate
    ;;
  goto)
    goto
    ;;
esac